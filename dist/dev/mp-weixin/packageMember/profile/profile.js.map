{"version":3,"file":"profile.js","sources":["../../../../../src/packageMember/profile/profile.vue","../../../../../uniPage:/cGFja2FnZU1lbWJlclxwcm9maWxlXHByb2ZpbGUudnVl"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onLoad } from '@dcloudio/uni-app'\nimport { ref } from 'vue'\n\nimport { getMemberProfileApi, putMemberProfileApi } from '@/services/profile'\nimport { useMemberStore } from '@/stores'\nimport type { ProfileResult, ProfileParmas, Gender } from '@/types/member'\n// 获取屏幕边界到安全区域距离\nconst { safeAreaInsets } = uni.getSystemInfoSync()\n\nconst memberStore = useMemberStore()\nconst memberInfo = ref({} as ProfileResult)\nconst getProfileData = async () => {\n  const { result } = await getMemberProfileApi<ProfileResult>()\n  memberInfo.value = result\n}\n\nconst onAvatarChange = () => {\n  uni.chooseMedia({\n    count: 1,\n    mediaType: ['image'],\n    success: ({ tempFiles }) => {\n      const filePath = tempFiles[0].tempFilePath\n      console.log(filePath)\n\n      uni.uploadFile({\n        url: '/member/profile/avatar',\n        name: 'file',\n        filePath,\n        success: (res) => {\n          if (res.statusCode === 200) {\n            // 提取头像\n            const { avatar } = JSON.parse(res.data).result\n            // 当前页面更新头像\n            memberInfo.value!.avatar = avatar // [!code ++]\n            // 更新 Store 头像\n            memberStore.profile!.avatar = avatar // [!code ++]\n            uni.showToast({ icon: 'success', title: '更新成功' })\n          } else {\n            uni.showToast({ icon: 'error', title: '出现错误' })\n          }\n        },\n        fail: (fail) => {\n          console.log(fail)\n        },\n      })\n    },\n  })\n}\n\nconst onGenderChange: UniHelper.RadioGroupOnChange = (e) => {\n  memberInfo.value.gender = e.detail.value as Gender\n}\n\nconst onDateChange: UniHelper.DatePickerOnChange = (e) => {\n  memberInfo.value.birthday = e.detail.value\n}\n\nlet fullLocation: [string, string, string] = ['', '', '']\nconst onRegionChange: UniHelper.RegionPickerOnChange = (e) => {\n  fullLocation = e.detail.code!\n  memberInfo.value.fullLocation = e.detail.value.join(' ')\n}\n\nconst onSubmit = async () => {\n  const data: ProfileParmas = {\n    nickname: memberInfo.value.nickname,\n    gender: memberInfo.value.gender,\n    birthday: memberInfo.value.birthday,\n    provinceCode: fullLocation[0],\n    cityCode: fullLocation[1],\n    countyCode: fullLocation[2],\n    profession: memberInfo.value.profession,\n  }\n  const { result } = await putMemberProfileApi<ProfileResult>(data)\n  memberInfo.value = result\n  memberStore.profile!.nickname = memberInfo.value.nickname\n  uni.showToast({ icon: 'success', title: '修改成功' })\n  setTimeout(() => {\n    uni.navigateBack()\n  }, 500)\n}\n\nonLoad(() => {\n  getProfileData()\n})\n</script>\n\n<template>\n  <view class=\"viewport\">\n    <!-- 导航栏 -->\n    <view class=\"navbar\" :style=\"{ paddingTop: safeAreaInsets?.top + 'px' }\">\n      <navigator open-type=\"navigateBack\" class=\"back icon-left\" hover-class=\"none\"></navigator>\n      <view class=\"title\">个人信息</view>\n    </view>\n    <!-- 头像 -->\n    <view class=\"avatar\" @tap=\"onAvatarChange\">\n      <view class=\"avatar-content\">\n        <image class=\"image\" :src=\"memberInfo?.avatar\" mode=\"aspectFill\" />\n        <text class=\"text\">点击修改头像</text>\n      </view>\n    </view>\n    <!-- 表单 -->\n    <view class=\"form\">\n      <!-- 表单内容 -->\n      <view class=\"form-content\">\n        <view class=\"form-item\">\n          <text class=\"label\">账号</text>\n          <text class=\"account\">{{ memberInfo?.account }}</text>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">昵称</text>\n          <input\n            class=\"input\"\n            type=\"text\"\n            placeholder=\"请填写昵称\"\n            v-model=\"memberInfo!.nickname\"\n          />\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">性别</text>\n          <radio-group @change=\"onGenderChange\">\n            <label class=\"radio\">\n              <radio value=\"男\" color=\"#27ba9b\" :checked=\"memberInfo?.gender === '男'\" />\n              男\n            </label>\n            <label class=\"radio\">\n              <radio value=\"女\" color=\"#27ba9b\" :checked=\"memberInfo?.gender === '女'\" />\n              女\n            </label>\n          </radio-group>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">生日</text>\n          <picker\n            class=\"picker\"\n            mode=\"date\"\n            start=\"1900-01-01\"\n            :end=\"new Date()\"\n            :value=\"memberInfo?.birthday\"\n            @change=\"onDateChange\"\n          >\n            <view v-if=\"memberInfo?.birthday\">{{ memberInfo?.birthday }}</view>\n            <view class=\"placeholder\" v-else>请选择日期</view>\n          </picker>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">城市</text>\n          <picker\n            class=\"picker\"\n            mode=\"region\"\n            :value=\"memberInfo?.fullLocation?.split(' ')\"\n            @change=\"onRegionChange\"\n          >\n            <view v-if=\"memberInfo?.fullLocation\">{{ memberInfo?.fullLocation }}</view>\n            <view class=\"placeholder\" v-else>请选择城市</view>\n          </picker>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">职业</text>\n          <input\n            class=\"input\"\n            type=\"text\"\n            placeholder=\"请填写职业\"\n            v-model=\"memberInfo!.profession\"\n          />\n        </view>\n      </view>\n      <!-- 提交按钮 -->\n      <button class=\"form-button\" @tap=\"onSubmit\">保 存</button>\n    </view>\n  </view>\n</template>\n\n<style lang=\"scss\">\npage {\n  background-color: #f4f4f4;\n}\n\n.viewport {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background-image: url(https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/images/order_bg.png);\n  background-size: auto 420rpx;\n  background-repeat: no-repeat;\n}\n\n// 导航栏\n.navbar {\n  position: relative;\n\n  .title {\n    height: 40px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-size: 16px;\n    font-weight: 500;\n    color: #fff;\n  }\n\n  .back {\n    position: absolute;\n    height: 40px;\n    width: 40px;\n    left: 0;\n    font-size: 20px;\n    color: #fff;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n}\n\n// 头像\n.avatar {\n  text-align: center;\n  width: 100%;\n  height: 260rpx;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n\n  .image {\n    width: 160rpx;\n    height: 160rpx;\n    border-radius: 50%;\n    background-color: #eee;\n  }\n\n  .text {\n    display: block;\n    padding-top: 20rpx;\n    line-height: 1;\n    font-size: 26rpx;\n    color: #fff;\n  }\n}\n\n// 表单\n.form {\n  background-color: #f4f4f4;\n\n  &-content {\n    margin: 20rpx 20rpx 0;\n    padding: 0 20rpx;\n    border-radius: 10rpx;\n    background-color: #fff;\n  }\n\n  &-item {\n    display: flex;\n    height: 96rpx;\n    line-height: 46rpx;\n    padding: 25rpx 10rpx;\n    background-color: #fff;\n    font-size: 28rpx;\n    border-bottom: 1rpx solid #ddd;\n\n    &:last-child {\n      border: none;\n    }\n\n    .label {\n      width: 180rpx;\n      color: #333;\n    }\n\n    .account {\n      color: #666;\n    }\n\n    .input {\n      flex: 1;\n      display: block;\n      height: 46rpx;\n    }\n\n    .radio {\n      margin-right: 20rpx;\n    }\n\n    .picker {\n      flex: 1;\n    }\n    .placeholder {\n      color: #808080;\n    }\n  }\n\n  &-button {\n    height: 80rpx;\n    text-align: center;\n    line-height: 80rpx;\n    margin: 30rpx 20rpx;\n    color: #fff;\n    border-radius: 80rpx;\n    font-size: 30rpx;\n    background-color: #27ba9b;\n  }\n}\n</style>\n","import MiniProgramPage from 'D:/Arjence/学习/uniapp/heima-shop/src/packageMember/profile/profile.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","useMemberStore","ref","getMemberProfileApi","putMemberProfileApi","onLoad"],"mappings":";;;;;;;;;AAQA,UAAM,EAAE,eAAA,IAAmBA,cAAA,MAAI,kBAAkB;AAEjD,UAAM,cAAcC,sBAAAA;AACd,UAAA,aAAaC,kBAAI,CAAA,CAAmB;AAC1C,UAAM,iBAAiB,YAAY;AACjC,YAAM,EAAE,OAAA,IAAW,MAAMC,iBAAAA;AACzB,iBAAW,QAAQ;AAAA,IAAA;AAGrB,UAAM,iBAAiB,MAAM;AAC3BH,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,QACP,WAAW,CAAC,OAAO;AAAA,QACnB,SAAS,CAAC,EAAE,gBAAgB;AACpB,gBAAA,WAAW,UAAU,CAAC,EAAE;AAC9B,kBAAQ,IAAI,QAAQ;AAEpBA,wBAAAA,MAAI,WAAW;AAAA,YACb,KAAK;AAAA,YACL,MAAM;AAAA,YACN;AAAA,YACA,SAAS,CAAC,QAAQ;AACZ,kBAAA,IAAI,eAAe,KAAK;AAE1B,sBAAM,EAAE,OAAO,IAAI,KAAK,MAAM,IAAI,IAAI,EAAE;AAExC,2BAAW,MAAO,SAAS;AAE3B,4BAAY,QAAS,SAAS;AAC9BA,8BAAA,MAAI,UAAU,EAAE,MAAM,WAAW,OAAO,QAAQ;AAAA,cAAA,OAC3C;AACLA,8BAAA,MAAI,UAAU,EAAE,MAAM,SAAS,OAAO,QAAQ;AAAA,cAChD;AAAA,YACF;AAAA,YACA,MAAM,CAAC,SAAS;AACd,sBAAQ,IAAI,IAAI;AAAA,YAClB;AAAA,UAAA,CACD;AAAA,QACH;AAAA,MAAA,CACD;AAAA,IAAA;AAGG,UAAA,iBAA+C,CAAC,MAAM;AAC/C,iBAAA,MAAM,SAAS,EAAE,OAAO;AAAA,IAAA;AAG/B,UAAA,eAA6C,CAAC,MAAM;AAC7C,iBAAA,MAAM,WAAW,EAAE,OAAO;AAAA,IAAA;AAGvC,QAAI,eAAyC,CAAC,IAAI,IAAI,EAAE;AAClD,UAAA,iBAAiD,CAAC,MAAM;AAC5D,qBAAe,EAAE,OAAO;AACxB,iBAAW,MAAM,eAAe,EAAE,OAAO,MAAM,KAAK,GAAG;AAAA,IAAA;AAGzD,UAAM,WAAW,YAAY;AAC3B,YAAM,OAAsB;AAAA,QAC1B,UAAU,WAAW,MAAM;AAAA,QAC3B,QAAQ,WAAW,MAAM;AAAA,QACzB,UAAU,WAAW,MAAM;AAAA,QAC3B,cAAc,aAAa,CAAC;AAAA,QAC5B,UAAU,aAAa,CAAC;AAAA,QACxB,YAAY,aAAa,CAAC;AAAA,QAC1B,YAAY,WAAW,MAAM;AAAA,MAAA;AAE/B,YAAM,EAAE,OAAW,IAAA,MAAMI,qCAAmC,IAAI;AAChE,iBAAW,QAAQ;AACP,kBAAA,QAAS,WAAW,WAAW,MAAM;AACjDJ,oBAAA,MAAI,UAAU,EAAE,MAAM,WAAW,OAAO,QAAQ;AAChD,iBAAW,MAAM;AACfA,sBAAA,MAAI,aAAa;AAAA,SAChB,GAAG;AAAA,IAAA;AAGRK,kBAAAA,OAAO,MAAM;AACI;IAAA,CAChB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpFD,GAAG,WAAW,eAAe;"}
{"version":3,"file":"main-cart.js","sources":["../../../../../../src/pages/cart/cpns/main-cart.vue","../../../../../../uniComponent:/RDovQXJqZW5jZS_lrabkuaAvdW5pYXBwL2hlaW1hLXNob3Avc3JjL3BhZ2VzL2NhcnQvY3Bucy9tYWluLWNhcnQudnVl"],"sourcesContent":["<script setup lang=\"ts\">\nimport { computed, ref } from 'vue'\nimport { onShow } from '@dcloudio/uni-app'\nimport {\n  getMemberCartApi,\n  deleteMemberCartBySkuIdsApi,\n  putMemberCartBySkuIdApi,\n  putMemberCartSelectedApi,\n} from '@/services/cart'\nimport { debounce } from '@/utils/debounce'\n\nimport type { CartItem } from '@/types/cart'\nimport type { InputNumberBoxEvent } from '@/components/vk-data-input-number-box/vk-data-input-number-box'\nimport { useGuess } from '@/composables/useGuess'\n\nconst props = defineProps<{\n  isTab: false\n}>()\n\nlet { safeAreaInsets } = uni.getSystemInfoSync()\n\nconst { guessRef, onScrollToLower } = useGuess()\n\nconst memberCartList = ref<CartItem[]>([])\nconst getMemberCartData = async () => {\n  const { result } = await getMemberCartApi<CartItem[]>()\n  memberCartList.value = result\n}\n\nconst onDelete = (skuId: string) => {\n  uni.showModal({\n    content: '确定删除吗？',\n    success: async (success) => {\n      if (success) {\n        const { result } = await deleteMemberCartBySkuIdsApi([skuId])\n        if (result) {\n          const index = memberCartList.value.findIndex((item) => item.skuId === skuId)\n          memberCartList.value.splice(index, 1)\n        } else {\n          uni.showToast({ icon: 'fail', title: '删除失败，请重试！' })\n        }\n      }\n    },\n  })\n}\n\n//防抖\nconst onChangeCount = debounce((e: InputNumberBoxEvent) => {\n  putMemberCartBySkuIdApi(e.index, { count: e.value })\n}, 200)\n\nconst onChangeSelect = (item: CartItem) => {\n  item.selected = !item.selected\n  putMemberCartBySkuIdApi(item.skuId, { selected: item.selected })\n}\n\nconst selectAll = computed(() => memberCartList.value.every((item) => item.selected), {})\n\nconst changeSelectAll = () => {\n  const _selectAll = !selectAll.value\n  memberCartList.value.forEach((item) => (item.selected = _selectAll))\n  putMemberCartSelectedApi(_selectAll)\n}\n\nconst selectedList = computed(() => memberCartList.value.filter((item) => item.selected))\n\nconst selectedAllCount = computed(() => {\n  return selectedList.value.reduce((pre, cur) => pre + cur.count, 0)\n})\n\nconst selectedAccount = computed(() => {\n  return selectedList.value.reduce((pre, cur) => pre + (cur.nowPrice * 100 * cur.count) / 100, 0)\n})\n\nconst onSettleAccount = () => {\n  if (selectedList.value.length === 0) {\n    return uni.showToast({\n      title: '请选择商品！',\n    })\n  }\n\n  uni.navigateTo({ url: '/packageOrder/create/create' })\n}\n\nonShow(() => {\n  getMemberCartData()\n})\n</script>\n\n<template>\n  <scroll-view scroll-y class=\"scroll-view\" @scrolltolower=\"onScrollToLower\">\n    <!-- 已登录: 显示购物车 -->\n    <template v-if=\"true\">\n      <!-- 购物车列表 -->\n      <view class=\"cart-list\" v-if=\"memberCartList.length\">\n        <!-- 优惠提示 -->\n        <view class=\"tips\">\n          <text class=\"label\">满减</text>\n          <text class=\"desc\">满1件, 即可享受9折优惠</text>\n        </view>\n        <!-- 滑动操作分区 -->\n        <uni-swipe-action>\n          <!-- 滑动操作项 -->\n          <uni-swipe-action-item\n            v-for=\"item of memberCartList\"\n            :key=\"item.skuId\"\n            class=\"cart-swipe\"\n          >\n            <!-- 商品信息 -->\n            <view class=\"goods\">\n              <!-- 选中状态 -->\n              <text\n                class=\"checkbox\"\n                @tap=\"onChangeSelect(item)\"\n                :class=\"{ checked: item.selected }\"\n              ></text>\n              <navigator\n                :url=\"`/pages/goods/goods?id=${item.id}`\"\n                hover-class=\"none\"\n                class=\"navigator\"\n              >\n                <image mode=\"aspectFill\" class=\"picture\" :src=\"item.picture\"></image>\n                <view class=\"meta\">\n                  <view class=\"name ellipsis\">{{ item.name }}</view>\n                  <view class=\"attrsText ellipsis\">{{ item.attrsText }}</view>\n                  <view class=\"price\">{{ item.nowPrice }}</view>\n                </view>\n              </navigator>\n              <!-- 商品数量 -->\n              <view class=\"count\">\n                <vk-data-input-number-box\n                  @change=\"onChangeCount\"\n                  :min=\"1\"\n                  :max=\"item.stock\"\n                  :index=\"item.skuId\"\n                  v-model=\"item.count\"\n                />\n              </view>\n            </view>\n            <!-- 右侧删除按钮 -->\n            <template #right>\n              <view class=\"cart-swipe-right\">\n                <button @tap=\"onDelete(item.skuId)\" class=\"button delete-button\">删除</button>\n              </view>\n            </template>\n          </uni-swipe-action-item>\n        </uni-swipe-action>\n      </view>\n      <!-- 购物车空状态 -->\n      <view class=\"cart-blank\" v-else>\n        <image src=\"/static/images/blank_cart.png\" class=\"image\" />\n        <text class=\"text\">购物车还是空的，快来挑选好货吧</text>\n        <navigator open-type=\"switchTab\" url=\"/pages/index/index\" hover-class=\"none\">\n          <button class=\"button\">去首页看看</button>\n        </navigator>\n      </view>\n      <!-- 吸底工具栏 -->\n      <view class=\"toolbar\" :style=\"{ paddingBottom: (isTab ? 0 : safeAreaInsets?.bottom) + 'px' }\">\n        <text class=\"all\" @tap=\"changeSelectAll\" :class=\"{ checked: selectAll }\">全选</text>\n        <text class=\"text\">合计:</text>\n        <text class=\"amount\">{{ selectedAccount }}</text>\n        <view class=\"button-grounp\">\n          <view\n            class=\"button payment-button\"\n            @tap=\"onSettleAccount\"\n            :class=\"{ disabled: selectedList.length === 0 }\"\n          >\n            去结算({{ selectedAllCount }})</view\n          >\n        </view>\n      </view>\n    </template>\n    <!-- 未登录: 提示登录 -->\n    <view class=\"login-blank\" v-else>\n      <text class=\"text\">登录后可查看购物车中的商品</text>\n      <navigator url=\"/pages/login/login\" hover-class=\"none\">\n        <button class=\"button\">去登录</button>\n      </navigator>\n    </view>\n    <!-- 猜你喜欢 -->\n    <XtxGuess ref=\"guessRef\"></XtxGuess>\n    <!-- 底部占位空盒子 -->\n    <view class=\"toolbar-height\"></view>\n  </scroll-view>\n</template>\n\n<style lang=\"scss\">\n// 根元素\n:host {\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  background-color: #f7f7f8;\n}\n\n// 滚动容器\n.scroll-view {\n  flex: 1;\n}\n\n// 购物车列表\n.cart-list {\n  padding: 0 20rpx;\n\n  // 优惠提示\n  .tips {\n    display: flex;\n    align-items: center;\n    line-height: 1;\n    margin: 30rpx 10rpx;\n    font-size: 26rpx;\n    color: #666;\n\n    .label {\n      color: #fff;\n      padding: 7rpx 15rpx 5rpx;\n      border-radius: 4rpx;\n      font-size: 24rpx;\n      background-color: #27ba9b;\n      margin-right: 10rpx;\n    }\n  }\n\n  // 购物车商品\n  .goods {\n    display: flex;\n    padding: 20rpx 20rpx 20rpx 80rpx;\n    border-radius: 10rpx;\n    background-color: #fff;\n    position: relative;\n\n    .navigator {\n      display: flex;\n    }\n\n    .checkbox {\n      position: absolute;\n      top: 0;\n      left: 0;\n\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: 80rpx;\n      height: 100%;\n\n      &::before {\n        content: '\\e6cd';\n        font-family: 'erabbit' !important;\n        font-size: 40rpx;\n        color: #444;\n      }\n\n      &.checked::before {\n        content: '\\e6cc';\n        color: #27ba9b;\n      }\n    }\n\n    .picture {\n      width: 170rpx;\n      height: 170rpx;\n    }\n\n    .meta {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      justify-content: space-between;\n      margin-left: 20rpx;\n    }\n\n    .name {\n      height: 72rpx;\n      font-size: 26rpx;\n      color: #444;\n    }\n\n    .attrsText {\n      line-height: 1.8;\n      padding: 0 15rpx;\n      font-size: 24rpx;\n      align-self: flex-start;\n      border-radius: 4rpx;\n      color: #888;\n      background-color: #f7f7f8;\n    }\n\n    .price {\n      line-height: 1;\n      font-size: 26rpx;\n      color: #444;\n      margin-bottom: 2rpx;\n      color: #cf4444;\n\n      &::before {\n        content: '￥';\n        font-size: 80%;\n      }\n    }\n\n    // 商品数量\n    .count {\n      position: absolute;\n      bottom: 20rpx;\n      right: 5rpx;\n\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      width: 220rpx;\n      height: 48rpx;\n\n      .text {\n        height: 100%;\n        padding: 0 20rpx;\n        font-size: 32rpx;\n        color: #444;\n      }\n\n      .input {\n        height: 100%;\n        text-align: center;\n        border-radius: 4rpx;\n        font-size: 24rpx;\n        color: #444;\n        background-color: #f6f6f6;\n      }\n    }\n  }\n\n  .cart-swipe {\n    display: block;\n    margin: 20rpx 0;\n  }\n\n  .cart-swipe-right {\n    display: flex;\n    height: 100%;\n\n    .button {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 50px;\n      padding: 6px;\n      line-height: 1.5;\n      color: #fff;\n      font-size: 26rpx;\n      border-radius: 0;\n    }\n\n    .delete-button {\n      background-color: #cf4444;\n    }\n  }\n}\n\n// 空状态\n.cart-blank,\n.login-blank {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n  height: 60vh;\n  .image {\n    width: 400rpx;\n    height: 281rpx;\n  }\n  .text {\n    color: #444;\n    font-size: 26rpx;\n    margin: 20rpx 0;\n  }\n  .button {\n    width: 240rpx !important;\n    height: 60rpx;\n    line-height: 60rpx;\n    margin-top: 20rpx;\n    font-size: 26rpx;\n    border-radius: 60rpx;\n    color: #fff;\n    background-color: #27ba9b;\n  }\n}\n\n// 吸底工具栏\n.toolbar {\n  position: fixed;\n  left: 0;\n  right: 0;\n  bottom: var(--window-bottom);\n  z-index: 1;\n\n  height: 100rpx;\n  padding: 0 20rpx;\n  display: flex;\n  align-items: center;\n  border-top: 1rpx solid #ededed;\n  border-bottom: 1rpx solid #ededed;\n  background-color: #fff;\n  box-sizing: content-box;\n\n  .all {\n    margin-left: 25rpx;\n    font-size: 14px;\n    color: #444;\n    display: flex;\n    align-items: center;\n  }\n\n  .all::before {\n    font-family: 'erabbit' !important;\n    content: '\\e6cd';\n    font-size: 40rpx;\n    margin-right: 8rpx;\n  }\n\n  .checked::before {\n    content: '\\e6cc';\n    color: #27ba9b;\n  }\n\n  .text {\n    margin-right: 8rpx;\n    margin-left: 32rpx;\n    color: #444;\n    font-size: 14px;\n  }\n\n  .amount {\n    font-size: 20px;\n    color: #cf4444;\n\n    .decimal {\n      font-size: 12px;\n    }\n\n    &::before {\n      content: '￥';\n      font-size: 12px;\n    }\n  }\n\n  .button-grounp {\n    margin-left: auto;\n    display: flex;\n    justify-content: space-between;\n    text-align: center;\n    line-height: 72rpx;\n    font-size: 13px;\n    color: #fff;\n\n    .button {\n      width: 240rpx;\n      margin: 0 10rpx;\n      border-radius: 72rpx;\n    }\n\n    .payment-button {\n      background-color: #27ba9b;\n\n      &.disabled {\n        opacity: 0.6;\n      }\n    }\n  }\n}\n// 底部占位空盒子\n.toolbar-height {\n  height: 100rpx;\n}\n</style>\n","import Component from 'D:/Arjence/学习/uniapp/heima-shop/src/pages/cart/cpns/main-cart.vue'\nwx.createComponent(Component)"],"names":["uni","useGuess","ref","getMemberCartApi","deleteMemberCartBySkuIdsApi","debounce","putMemberCartBySkuIdApi","computed","putMemberCartSelectedApi","onShow"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmBA,QAAI,EAAE,eAAA,IAAmBA,cAAA,MAAI,kBAAkB;AAE/C,UAAM,EAAE,UAAU,gBAAgB,IAAIC,qBAAS,SAAA;AAEzC,UAAA,iBAAiBC,kBAAgB,CAAA,CAAE;AACzC,UAAM,oBAAoB,YAAY;AACpC,YAAM,EAAE,OAAA,IAAW,MAAMC,cAAAA;AACzB,qBAAe,QAAQ;AAAA,IAAA;AAGnB,UAAA,WAAW,CAAC,UAAkB;AAClCH,oBAAAA,MAAI,UAAU;AAAA,QACZ,SAAS;AAAA,QACT,SAAS,OAAO,YAAY;AAC1B,cAAI,SAAS;AACX,kBAAM,EAAE,OAAO,IAAI,MAAMI,cAA4B,4BAAA,CAAC,KAAK,CAAC;AAC5D,gBAAI,QAAQ;AACJ,oBAAA,QAAQ,eAAe,MAAM,UAAU,CAAC,SAAS,KAAK,UAAU,KAAK;AAC5D,6BAAA,MAAM,OAAO,OAAO,CAAC;AAAA,YAAA,OAC/B;AACLJ,4BAAA,MAAI,UAAU,EAAE,MAAM,QAAQ,OAAO,aAAa;AAAA,YACpD;AAAA,UACF;AAAA,QACF;AAAA,MAAA,CACD;AAAA,IAAA;AAIG,UAAA,gBAAgBK,wBAAS,CAAC,MAA2B;AACzDC,oBAAA,wBAAwB,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO;AAAA,OAClD,GAAG;AAEA,UAAA,iBAAiB,CAAC,SAAmB;AACpC,WAAA,WAAW,CAAC,KAAK;AACtBA,oBAAA,wBAAwB,KAAK,OAAO,EAAE,UAAU,KAAK,UAAU;AAAA,IAAA;AAGjE,UAAM,YAAYC,cAAAA,SAAS,MAAM,eAAe,MAAM,MAAM,CAAC,SAAS,KAAK,QAAQ,GAAG,CAAE,CAAA;AAExF,UAAM,kBAAkB,MAAM;AACtB,YAAA,aAAa,CAAC,UAAU;AAC9B,qBAAe,MAAM,QAAQ,CAAC,SAAU,KAAK,WAAW,UAAW;AACnEC,oBAAA,yBAAyB,UAAU;AAAA,IAAA;AAG/B,UAAA,eAAeD,cAAAA,SAAS,MAAM,eAAe,MAAM,OAAO,CAAC,SAAS,KAAK,QAAQ,CAAC;AAElF,UAAA,mBAAmBA,cAAAA,SAAS,MAAM;AAC/B,aAAA,aAAa,MAAM,OAAO,CAAC,KAAK,QAAQ,MAAM,IAAI,OAAO,CAAC;AAAA,IAAA,CAClE;AAEK,UAAA,kBAAkBA,cAAAA,SAAS,MAAM;AACrC,aAAO,aAAa,MAAM,OAAO,CAAC,KAAK,QAAQ,MAAO,IAAI,WAAW,MAAM,IAAI,QAAS,KAAK,CAAC;AAAA,IAAA,CAC/F;AAED,UAAM,kBAAkB,MAAM;AACxB,UAAA,aAAa,MAAM,WAAW,GAAG;AACnC,eAAOP,cAAAA,MAAI,UAAU;AAAA,UACnB,OAAO;AAAA,QAAA,CACR;AAAA,MACH;AAEAA,oBAAAA,MAAI,WAAW,EAAE,KAAK,8BAA+B,CAAA;AAAA,IAAA;AAGvDS,kBAAAA,OAAO,MAAM;AACO;IAAA,CACnB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrFD,GAAG,gBAAgB,SAAS;"}